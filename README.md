# Телеграм-бот для расписания ВУЗа

Телеграм-бот для просмотра расписания занятий в ВУЗе с учетом чередования недель (первая/вторая неделя) и административной панелью для управления расписанием.

## Функциональность

### Для пользователей:

- Выбор группы
- Просмотр расписания на сегодня
- Просмотр расписания на завтра
- Просмотр расписания на текущую неделю
- Смена группы

### Для администраторов:

- Управление группами (добавление, редактирование, удаление)
- Управление расписанием (добавление, редактирование, удаление занятий)

## Технологии

- TypeScript
- Node.js
- Telegraf (фреймворк для Telegram ботов)
- TypeORM (ORM для работы с базой данных)
- PostgreSQL (база данных)
- date-fns (библиотека для работы с датами)

## Установка и запуск

1. Клонировать репозиторий:

```
git clone <url-репозитория>
cd schedule
```

2. Установить зависимости:

```
npm install
```

3. Настроить переменные окружения в файле `.env`:

```
# Database
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=username
DB_PASSWORD=password
DB_DATABASE=schedule

# Telegram
TELEGRAM_BOT_TOKEN=your_telegram_bot_token

# Admin
ADMIN_USERNAME=admin
ADMIN_PASSWORD=admin123
JWT_SECRET=your_jwt_secret
```

4. Запустить приложение в режиме разработки:

```
npm run dev
```

5. Для сборки и запуска в продакшн:

```
npm run build
npm start
```

## Развертывание с помощью Docker

Для развертывания приложения с помощью Docker выполните следующие шаги:

### Предварительные требования

- Docker
- Docker Compose

### Шаги по развертыванию

1. Клонируйте репозиторий:

   ```bash
   git clone <url-репозитория>
   cd schedule
   ```

2. Создайте файл `.env` на основе `.env.example`:

   ```bash
   cp .env.example .env
   ```

3. Отредактируйте файл `.env`, указав необходимые параметры:

   - `TELEGRAM_BOT_TOKEN` - токен вашего Telegram бота
   - `DB_HOST` - для Docker Compose можно оставить `db` (имя сервиса)
   - Другие параметры по необходимости

4. Запустите приложение с помощью Docker Compose:

   ```bash
   docker-compose up -d
   ```

   > **Примечание**: Директория `node_modules` не включена в репозиторий и не копируется в Docker-образ. Все зависимости будут установлены автоматически при сборке образа.

5. Для просмотра логов:

   ```bash
   docker-compose logs -f bot
   ```

6. Для остановки приложения:
   ```bash
   docker-compose down
   ```

### Обновление приложения

Для обновления приложения выполните следующие команды:

```bash
git pull
docker-compose build
docker-compose up -d
```

### Резервное копирование базы данных

Для создания резервной копии базы данных:

```bash
docker-compose exec db pg_dump -U ${DB_USERNAME} ${DB_DATABASE} > backup.sql
```

Для восстановления из резервной копии:

```bash
cat backup.sql | docker-compose exec -T db psql -U ${DB_USERNAME} ${DB_DATABASE}
```

## Структура проекта

- `src/` - исходный код
  - `bot/` - логика телеграм-бота
    - `scenes/` - сцены для диалогов
    - `keyboards.ts` - клавиатуры для бота
    - `formatters.ts` - форматирование сообщений
    - `index.ts` - основной файл бота
  - `database/` - настройка подключения к базе данных
  - `entities/` - модели данных
  - `services/` - бизнес-логика
  - `utils/` - вспомогательные функции
  - `index.ts` - точка входа

## Команды бота

- `/start` - Начать работу с ботом
- `/group` - Выбрать группу
- `/admin` - Войти в панель администратора

## Лицензия

MIT
